Interface von query_db
======================

query_db speichert die magic-Karten in einer mysql-Datenbank und ermöglicht Abfragen dazu.
Wie das genau funktioniert muss der Anwender von query_db nicht wissen. Er muss nur das hier
beschriebene Interface kennen.

Das Interface von query_db besteht aus einigen ausführbaren Programmen (unter Umständen als Scripte
implementiert) sowie einer Bibliothek mit C-Funktionen. Für die Abfragen wird eine Sprache verwendet,
die problemorientiert ist (aber relativ einfach in SQL umgewandelt werden kann).

0. Voraussetzungen
Der lokale mysql-Server muss laufen, der aktuelle User muss ihn benutzen dürfen, siehe
../../doc/readme_mysql.txt

1. ausführbare Programme

qdb_create DBName Tabellendefinition
   erzeugt die Datenbank 'DBName' mit den Tabellen, die im angegebenen File beschrieben sind:
   Tabellendefinition ist ein zeilenorientiertes Textfile und hat folgenden Aufbau:

   table Tabellename
    Eigenschaft Typ
    Eigenschaft Typ
    ...
   endttable
   ...

   Eine Eigenschaft muss mit einem * versehen sein = Primärschlüssel:
    *Eigenschaft Typ
    Eigenschaft muss eindeutig in der Tabelle sein.
   Ein Fremdschlüssel wird mit einem + gekennzeichnet und sieht so aus:
    +Eigenschaft Typ Table2(Eigenschaft2)
    Eigenschaft wird auf die Werte von Eigenschaft2 in Table2 eingeschränkt.
    Eigenschaft2 muss Primärschlüssel in Table2 sein.
    Table2 muss vorher definiert worden sein !


   Es können mehrere Tabellen angegeben werden.
   Beachte, dass Fremdschlüssel nur rückwärts verweisen können.
   (Also normalerweise erst Edition, dann Card definieren.)

   Eigenschaft ist ein Name, der nachher in Abfragen verwendet werden kann. Als Typen sind erlaubt:
    int, string, string(laenge), color, mana, ident
    color, mana und ident sind Magic-spezifische Datentypen, sie werden unten beschrieben (s. 3. Abfragesprache).
   Wenn in den Tabellendefinitionen Eigenschaften fehlen, dann macht das nichts. Weitere Eigenschaften werden
   automatisch definiert, sobald sie beim Eintragen von Daten benutzt werden, dann immer mit dem Typ string.


qdb_show
   listet die vorhandenen Datenbanken.

qdb_show DBName
   zeigt den Aufbau der angegebene Datenbank.

qdb_delete DBName
   löscht die angegebene Datenbank (Achtung: Lösche nur selbst erzeugte Datenbanken !)



2. Bibliothek
 genauer --> siehe qdb.h
 Eintragen von Werten:
  dh = qdb_open(Name)
  qdb_close(dh)
    Öffnen und Schließen der angegebenen Datenbank

  eh = qdb_begin(dh,Tabellenname)
  qdb_property(eh,Propertyname,Value)
  ... weitere qdb_property()-Aufrufe, Value immer als C-string
  qdb_end(eh)
  Diese Aufrufe können geschachtelt werden, z.B:
   eh = qdb_begin(dh,"edition")
   qdb_property(eh,"name","6ED")
   ch = qdb_begin(eh,"card")
   qdb_property(ch,"name","Plains")
   qdb_property(ch,"id","237f51551c42ec1cec0d4417147d8d86c0027e00")
   qdb_end(ch)
   ...
   qdb_end(eh)

  Abfragen/Ändern
   qdb_query(dh,Tabellenname,Query) ...
   qdb_change(dh,Tabellenname,Query,Property,Newvalue)
   qdb_delete(dh,Tabellenname,Query)

3. Abfragesprache
 Die Sprache ist näher am Benutzer (also näher an Magic) als SQL, aber leicht in SQL zu übersetzen.

 Typen        --> SQL-Typ
  bool             TINYINT
  int              INT
  string           VARCHAR(1024)   CHARACTER SET utf8
  string(laenge)   VARCHAR(laenge) CHARACTER SET utf8
  ident            BINARY(20)
  color            SET ('White', 'Red', 'Green', 'Blue', 'Black')
  mana             VARCHAR(24)
  date             DATETIME

 Syntax
  t.b.d.
